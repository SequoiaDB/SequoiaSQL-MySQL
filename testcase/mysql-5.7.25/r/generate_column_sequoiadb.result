CREATE TABLE t1 (a INT, b INT, c INT GENERATED ALWAYS AS (a + 1) VIRTUAL, d INT GENERATED ALWAYS AS (b + 2) STORED );
INSERT INTO t1 (a, b) VALUES (1,2);
SELECT * FROM t1;
a	b	c	d
1	2	2	4
UPDATE t1 SET a = 2 WHERE c = 2;
SELECT * FROM t1;
a	b	c	d
2	2	3	4
UPDATE t1 SET a = 4;
SELECT * FROM t1;
a	b	c	d
4	2	5	4
UPDATE t1 SET b = 4 WHERE d = 4;
SELECT * FROM t1;
a	b	c	d
4	4	5	6
UPDATE t1 SET b = 8;
SELECT * FROM t1;
a	b	c	d
4	8	5	10
DELETE FROM t1 where d = 10;
DROP TABLE t1;
CREATE TABLE t1 (a INT, b INT GENERATED ALWAYS AS (a + 1) VIRTUAL, c INT GENERATED ALWAYS AS (b * 20) STORED );
INSERT INTO t1 (a) VALUES (1);
SELECT * FROM t1;
a	b	c
1	2	40
UPDATE t1 SET a = 2 WHERE c = 40;
SELECT * FROM t1;
a	b	c
2	3	60
DROP TABLE t1;
CREATE TABLE t1 (a INT, b INT GENERATED ALWAYS AS (a + 1) STORED, c INT GENERATED ALWAYS AS (b * 20) VIRTUAL );
INSERT INTO t1 (a) VALUES (1);
SELECT * FROM t1;
a	b	c
1	2	40
UPDATE t1 SET a = 2;
SELECT * FROM t1;
a	b	c
2	3	60
DROP TABLE t1;
CREATE TABLE t1 (a INT, b INT GENERATED ALWAYS AS (a + 1) VIRTUAL, c INT GENERATED ALWAYS AS (b * 20) VIRTUAL );
INSERT INTO t1 (a) VALUES (1);
SELECT * FROM t1;
a	b	c
1	2	40
UPDATE t1 SET a = 2;
SELECT * FROM t1;
a	b	c
2	3	60
DROP TABLE t1;
CREATE TABLE t1 (a INT, b INT GENERATED ALWAYS AS (a + 1) STORED, c INT GENERATED ALWAYS AS (b * 20) STORED );
INSERT INTO t1 (a) VALUES (1);
SELECT * FROM t1;
a	b	c
1	2	40
UPDATE t1 SET a = 2;
SELECT * FROM t1;
a	b	c
2	3	60
DROP TABLE t1;
CREATE TABLE t1 (a INT, b INT GENERATED ALWAYS AS (a + 1) VIRTUAL, c INT GENERATED ALWAYS AS (b * 20) STORED );
INSERT INTO t1 (a) VALUES (1);
SELECT * FROM t1;
a	b	c
1	2	40
UPDATE t1 SET a = 2;
SELECT * FROM t1;
a	b	c
2	3	60
DROP TABLE t1;
CREATE TABLE t1 (a INT, b INT);
INSERT INTO t1 (a,b) VALUES (1,1);
ALTER TABLE t1 ADD COLUMN (c INT GENERATED ALWAYS AS (a + 1) VIRTUAL), ALGORITHM=INPLACE;
ALTER TABLE t1 ADD COLUMN (d INT GENERATED ALWAYS AS (a + b + 20) STORED);
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` int(11) DEFAULT NULL,
  `c` int(11) GENERATED ALWAYS AS ((`a` + 1)) VIRTUAL,
  `d` int(11) GENERATED ALWAYS AS (((`a` + `b`) + 20)) STORED
) ENGINE=SEQUOIADB DEFAULT CHARSET=latin1
SELECT * FROM t1;
a	b	c	d
1	1	2	22
UPDATE t1 SET a = 2;
UPDATE t1 SET b = 2;
UPDATE t1 SET a = 4, b = 4;
CREATE INDEX a ON t1(a);
CREATE INDEX b ON t1(b);
CREATE INDEX c ON t1(c);
ERROR HY000: Table storage engine 'SequoiaDB' does not support the create option 'Index on virtual generated column'
CREATE INDEX d ON t1(d);
UPDATE t1 SET a =6;
UPDATE t1 SET b =6;
UPDATE t1 SET a = 8, b = 8;
SELECT * FROM t1;
a	b	c	d
8	8	9	36
ALTER TABLE t1 DROP COLUMN c, ALGORITHM=INPLACE;
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` int(11) DEFAULT NULL,
  `d` int(11) GENERATED ALWAYS AS (((`a` + `b`) + 20)) STORED,
  KEY `a` (`a`),
  KEY `b` (`b`),
  KEY `d` (`d`)
) ENGINE=SEQUOIADB DEFAULT CHARSET=latin1
ALTER TABLE t1 DROP COLUMN d, ALGORITHM=INPLACE;
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` int(11) DEFAULT NULL,
  KEY `a` (`a`),
  KEY `b` (`b`)
) ENGINE=SEQUOIADB DEFAULT CHARSET=latin1
SELECT * FROM t1;
a	b
8	8
DROP TABLE t1;
CREATE TABLE t1 (a INT KEY,b int NOT NULL DEFAULT 10 comment 'xxx');
INSERT INTO t1 (a) VALUES (1);
ALTER TABLE t1 ADD COLUMN (c INT GENERATED ALWAYS AS (a + 1) VIRTUAL, d INT GENERATED ALWAYS AS (b + 20) VIRTUAL), ALGORITHM=INPLACE;
ALTER TABLE t1 ADD COLUMN (e INT GENERATED ALWAYS AS (a + 1) VIRTUAL, f INT GENERATED ALWAYS AS (b + 20) VIRTUAL), ALGORITHM=INPLACE;
ALTER TABLE t1 ADD COLUMN (g INT GENERATED ALWAYS AS (a + 1) STORED, h INT GENERATED ALWAYS AS (b + 20) STORED);
ALTER TABLE t1 ADD COLUMN (i INT GENERATED ALWAYS AS (a + 1) STORED, j INT GENERATED ALWAYS AS (b + 20) STORED);
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) NOT NULL,
  `b` int(11) NOT NULL DEFAULT '10' COMMENT 'xxx',
  `c` int(11) GENERATED ALWAYS AS ((`a` + 1)) VIRTUAL,
  `d` int(11) GENERATED ALWAYS AS ((`b` + 20)) VIRTUAL,
  `e` int(11) GENERATED ALWAYS AS ((`a` + 1)) VIRTUAL,
  `f` int(11) GENERATED ALWAYS AS ((`b` + 20)) VIRTUAL,
  `g` int(11) GENERATED ALWAYS AS ((`a` + 1)) STORED,
  `h` int(11) GENERATED ALWAYS AS ((`b` + 20)) STORED,
  `i` int(11) GENERATED ALWAYS AS ((`a` + 1)) STORED,
  `j` int(11) GENERATED ALWAYS AS ((`b` + 20)) STORED,
  PRIMARY KEY (`a`)
) ENGINE=SEQUOIADB DEFAULT CHARSET=latin1
INSERT INTO t1 (a) VALUES (2);
SELECT * FROM t1;
a	b	c	d	e	f	g	h	i	j
1	10	2	30	2	30	2	30	2	30
2	10	3	30	3	30	3	30	3	30
ALTER TABLE t1 MODIFY b INT DEFAULT 30, ALGORITHM=INPLACE;
SELECT * FROM t1;
a	b	c	d	e	f	g	h	i	j
1	10	2	30	2	30	2	30	2	30
2	10	3	30	3	30	3	30	3	30
DROP TABLE t1;
CREATE TABLE t1 (a INT KEY AUTO_INCREMENT);
ALTER TABLE t1 ADD COLUMN (c INT GENERATED ALWAYS AS (a + 1) VIRTUAL, d INT GENERATED ALWAYS AS (a + 20) STORED);
ERROR HY000: Generated column 'c' cannot refer to auto-increment column.
DROP TABLE t1;
CREATE TABLE t1 (a INT, b INT, c INT GENERATED ALWAYS AS (a + 1) VIRTUAL, d INT GENERATED ALWAYS AS (b + 2) STORED );
INSERT INTO t1 (a,b) VALUES (1,1);
SELECT * FROM t1;
a	b	c	d
1	1	2	3
ALTER TABLE t1 CHANGE c c1 INT GENERATED ALWAYS AS (a + 10) VIRTUAL;
ALTER TABLE t1 CHANGE d d1 INT GENERATED ALWAYS AS (b + 20) STORED;
ALTER TABLE t1 MODIFY c1 DECIMAL GENERATED ALWAYS AS (a + 30) VIRTUAL FIRST, ALGORITHM=INPLACE;
ALTER TABLE t1 MODIFY d1 DECIMAL GENERATED ALWAYS AS (b + 20) STORED FIRST, ALGORITHM=INPLACE;
ALTER TABLE t1 MODIFY d1 DECIMAL GENERATED ALWAYS AS (b + 30) STORED;
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `d1` decimal(10,0) GENERATED ALWAYS AS ((`b` + 30)) STORED,
  `c1` decimal(10,0) GENERATED ALWAYS AS ((`a` + 30)) VIRTUAL,
  `a` int(11) DEFAULT NULL,
  `b` int(11) DEFAULT NULL
) ENGINE=SEQUOIADB DEFAULT CHARSET=latin1
SELECT * FROM t1;
d1	c1	a	b
31	31	1	1
DROP TABLE t1;
CREATE TABLE t1(a TINYINT,b TINYINT);
INSERT INTO t1 VALUES(127,127);
ALTER TABLE t1 ADD COLUMN c TINYINT AS (a + b);
ALTER TABLE t1 ADD COLUMN d TINYINT AS (a + b), WITH VALIDATION;
ERROR 22003: Out of range value for column 'c' at row 1
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` tinyint(4) DEFAULT NULL,
  `b` tinyint(4) DEFAULT NULL,
  `c` tinyint(4) GENERATED ALWAYS AS ((`a` + `b`)) VIRTUAL
) ENGINE=SEQUOIADB DEFAULT CHARSET=latin1
SELECT * FROM t1;
a	b	c
127	127	127
DROP TABLE t1;
CREATE TABLE t1 (a INT, c INT GENERATED ALWAYS AS (a + 1) VIRTUAL) COMMENT 'sequoiadb:{table_options:{ShardingKey:{c:1},ShardingType:"hash"}}';
ERROR HY000: Virtual generated column 'c' cannot be used for ShardingKey
