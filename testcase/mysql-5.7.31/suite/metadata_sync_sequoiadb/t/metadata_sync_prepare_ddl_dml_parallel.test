--source include/have_sequoiadb.inc
--source suite/metadata_sync_sequoiadb/inc/insts_connect_sequoiadb.inc

#seqDB-23106
connection conn1;
--disable_warnings
DROP DATABASE IF EXISTS metadata_prepare;
--enable_warnings
CREATE DATABASE metadata_prepare;
use metadata_prepare;

set @table = 't1';
set @s = concat('create table ', @table, '(a int)');
set server_ha_wait_sync_timeout = 4;
prepare stmt1 from @s;
execute stmt1;
deallocate prepare stmt1;
set server_ha_wait_sync_timeout = 0;

connection conn2;
use metadata_prepare;
prepare stmt1 from 'insert into t1 values(1)';
execute stmt1;
deallocate prepare stmt1;

connection conn1;
set server_ha_wait_sync_timeout = 4;
prepare stmt1 from 'drop table t1';
execute stmt1;
deallocate prepare stmt1;
set server_ha_wait_sync_timeout = 0;

connection conn2;
--error 1146
prepare stmt1 from 'insert into t1 values(1)';

--source include/uninstall_sequoiadb.inc
--source suite/metadata_sync_sequoiadb/inc/insts_disconnect_sequoiadb.inc
