#
# MDEV-17042: prepared statement does not return error with
# SQL_MODE STRICT_TRANS_TABLES. (Part 2)
#
drop table if exists t1;
create table t1(a int);
drop table t1;
set @save_sql_mode=@@sql_mode;
set sql_mode='STRICT_TRANS_TABLES';
Warnings:
Warning	3135	'NO_ZERO_DATE', 'NO_ZERO_IN_DATE' and 'ERROR_FOR_DIVISION_BY_ZERO' sql modes should be used with strict mode. They will be merged with strict mode in a future release.
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
CREATE TABLE t1 (id int, count int) engine=sequoiadb;
insert into t1 values (1,1),(0,2);
update t1 set count = count + 1 where id = '1bad';
ERROR 22007: Truncated incorrect DOUBLE value: '1bad'
prepare stmt from "update t1 set count = count + 1 where id = '1bad'";
execute stmt;
ERROR 22007: Truncated incorrect DOUBLE value: '1bad'
deallocate prepare stmt;
prepare stmt from 'update t1 set count = count + 1 where id = ?';
set @a = '1bad';
execute stmt using @a;
deallocate prepare stmt;
drop table t1;
CREATE TABLE t1 (id decimal(10,5), count int) engine=sequoiadb;
insert into t1 values (1,1),(0,2);
update t1 set count = count + 1 where id = '1bad';
prepare stmt from "update t1 set count = count + 1 where id = '1bad'";
execute stmt;
deallocate prepare stmt;
prepare stmt from 'update t1 set count = count + 1 where id = ?';
set @a = '1bad';
execute stmt using @a;
deallocate prepare stmt;
drop table t1;
CREATE TABLE t1 (id double, count int) engine=sequoiadb;
insert into t1 values (1,1),(0,2);
select * from t1 where id = '1bad';
id	count
1	1
Warnings:
Warning	1292	Truncated incorrect DOUBLE value: '1bad'
Warning	1292	Truncated incorrect DOUBLE value: '1bad'
update t1 set count = count + 1 where id = '1bad';
ERROR 22007: Truncated incorrect DOUBLE value: '1bad'
prepare stmt from "update t1 set count = count + 1 where id = '1bad'";
execute stmt;
ERROR 22007: Truncated incorrect DOUBLE value: '1bad'
deallocate prepare stmt;
prepare stmt from 'update t1 set count = count + 1 where id = ?';
set @a = '1bad';
execute stmt using @a;
deallocate prepare stmt;
drop table t1;
CREATE TABLE t1 (id date, count int) engine=sequoiadb;
insert into t1 values ("2019-06-11",1),("2019-06-12",2);
select * from t1 where id = '1bad';
id	count
Warnings:
Warning	1292	Incorrect date value: '1bad' for column 'id' at row 1
Warning	1292	Incorrect date value: '1bad' for column 'id' at row 1
update t1 set count = count + 1 where id = '1bad';
ERROR 22007: Incorrect date value: '1bad' for column 'id' at row 1
prepare stmt from "update t1 set count = count + 1 where id = '1bad'";
execute stmt;
ERROR 22007: Incorrect date value: '1bad' for column 'id' at row 1
deallocate prepare stmt;
prepare stmt from 'update t1 set count = count + 1 where id = ?';
set @a = '1bad';
execute stmt using @a;
ERROR 22007: Incorrect date value: '1bad' for column 'id' at row 1
deallocate prepare stmt;
drop table t1;
set sql_mode=@save_sql_mode;
Warnings:
Warning	3090	Changing sql mode 'NO_AUTO_CREATE_USER' is deprecated. It will be removed in a future release.
# End of 5.5 tests
